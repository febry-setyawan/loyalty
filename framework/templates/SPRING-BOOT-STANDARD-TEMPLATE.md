# Spring Boot Service Standard Template

**Generated by:** Senior Principal Engineer  
**Date:** December 2024  
**Purpose:** Standardized Spring Boot microservice template for loyalty system  

---

## 📋 Template Standards

### Required Information for New Service:
- **Service Name:** `{service-name}` (e.g., user, point, rewards, admin)
- **Service Purpose:** Brief description of service responsibility
- **Domain Context:** Business domain the service handles

### Technology Stack (Standardized):
- **Language:** Java 17
- **Framework:** Spring Boot 3.2.0
- **Build Tool:** Maven
- **Architecture Pattern:** Clean Architecture (Domain-Driven Design)
- **Database:** PostgreSQL + Redis (caching)
- **Message Queue:** Apache Kafka
- **Documentation:** OpenAPI/Swagger

---

## 📁 Standard Project Structure

```
{service-name}-service/
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/example/loyalty/{service-name}/
│   │   │       ├── domain/                      # Business Logic Layer
│   │   │       │   ├── entities/               # Domain entities
│   │   │       │   ├── repositories/           # Repository interfaces
│   │   │       │   ├── services/              # Domain services
│   │   │       │   └── valueobjects/          # Value objects
│   │   │       │
│   │   │       ├── application/               # Application Logic Layer
│   │   │       │   ├── usecases/             # Use case implementations
│   │   │       │   ├── dto/                   # Data Transfer Objects
│   │   │       │   └── validators/            # Input validation
│   │   │       │
│   │   │       ├── infrastructure/            # Infrastructure Layer
│   │   │       │   ├── persistence/          # Database implementations
│   │   │       │   │   ├── repositories/     # JPA/NoSQL repository implementations
│   │   │       │   │   ├── entities/         # Database entities
│   │   │       │   │   └── config/           # Database configuration
│   │   │       │   ├── external/             # External service integrations
│   │   │       │   ├── messaging/            # Message queue handling
│   │   │       │   │   ├── publishers/       # Message publishers
│   │   │       │   │   ├── consumers/        # Message consumers
│   │   │       │   │   └── config/           # Messaging configuration
│   │   │       │   └── config/               # Infrastructure configuration
│   │   │       │
│   │   │       ├── interfaces/               # Interface Layer (Controllers)
│   │   │       │   ├── web/                  # REST controllers
│   │   │       │   │   ├── controllers/      # REST controllers
│   │   │       │   │   ├── dto/              # Web DTOs (Request/Response)
│   │   │       │   │   ├── config/           # Web configuration
│   │   │       │   │   └── filters/          # Request/Response filters
│   │   │       │   └── messaging/            # Message handlers/listeners
│   │   │       │
│   │   │       ├── shared/                   # Shared utilities
│   │   │       │   ├── exceptions/           # Custom exception classes
│   │   │       │   ├── utils/                # Helper functions
│   │   │       │   └── constants/            # Application constants
│   │   │       │
│   │   │       └── {ServiceName}ServiceApplication.java    # Application entry point
│   │   │
│   │   └── resources/
│   │       ├── application.yml               # Main configuration
│   │       ├── application-dev.yml           # Development configuration
│   │       ├── application-staging.yml       # Staging configuration
│   │       ├── application-prod.yml          # Production configuration
│   │       ├── db/migration/                 # Database migrations (Flyway)
│   │       └── static/                       # Static resources (if needed)
│   │
│   └── test/
│       └── java/
│           └── com/example/loyalty/{service-name}/
│               ├── unit/                     # Unit tests
│               ├── integration/              # Integration tests
│               └── e2e/                      # End-to-end tests
│
├── docker/                                  # Docker configurations
│   ├── Dockerfile                          # Production Docker image
│   ├── Dockerfile.dev                      # Development Docker image
│   ├── docker-compose.yml                  # Local development
│   ├── docker-compose.test.yml            # Testing environment
│   └── .dockerignore                       # Docker ignore patterns
│
├── docs/                                    # Service documentation
│   ├── api/                                # API documentation
│   │   ├── openapi.yml                     # OpenAPI specification
│   │   └── postman/                        # Postman collections
│   ├── deployment/                         # Deployment guides
│   ├── development/                        # Development setup
│   └── architecture/                       # Architecture diagrams
│
├── scripts/                                # Utility scripts
│   ├── setup.sh                           # Development setup
│   ├── run-tests.sh                       # Test execution
│   ├── build.sh                           # Build script
│   └── deploy.sh                          # Deployment script
│
├── k8s/                                    # Kubernetes manifests
│   ├── base/                               # Base configuration
│   ├── development/                        # Development environment
│   ├── staging/                           # Staging environment
│   └── production/                        # Production environment
│
├── pom.xml                                # Maven configuration
├── .gitignore                             # Git ignore patterns
├── .dockerignore                          # Docker ignore patterns
├── README.md                              # Service documentation
└── CHANGELOG.md                           # Version history
```

---

## 📦 Standard Maven Configuration (pom.xml)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.2.0</version>
        <relativePath/>
    </parent>

    <groupId>com.example.loyalty</groupId>
    <artifactId>{service-name}-service</artifactId>
    <version>1.0.0-SNAPSHOT</version>
    <name>{Service Name} Service</name>
    <description>{Service description} for loyalty system</description>

    <properties>
        <java.version>17</java.version>
        <spring-cloud.version>2023.0.0</spring-cloud.version>
        <testcontainers.version>1.19.3</testcontainers.version>
        <openapi.version>2.3.0</openapi.version>
        <mapstruct.version>1.5.5.Final</mapstruct.version>
    </properties>

    <dependencies>
        <!-- Spring Boot Core Starters -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>

        <!-- Database -->
        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>org.flywaydb</groupId>
            <artifactId>flyway-core</artifactId>
        </dependency>

        <!-- Messaging -->
        <dependency>
            <groupId>org.springframework.kafka</groupId>
            <artifactId>spring-kafka</artifactId>
        </dependency>

        <!-- API Documentation -->
        <dependency>
            <groupId>org.springdoc</groupId>
            <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
            <version>${openapi.version}</version>
        </dependency>

        <!-- Object Mapping -->
        <dependency>
            <groupId>org.mapstruct</groupId>
            <artifactId>mapstruct</artifactId>
            <version>${mapstruct.version}</version>
        </dependency>

        <!-- JSON Processing -->
        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-databind</artifactId>
        </dependency>

        <!-- Testing -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.testcontainers</groupId>
            <artifactId>junit-jupiter</artifactId>
            <version>${testcontainers.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.testcontainers</groupId>
            <artifactId>postgresql</artifactId>
            <version>${testcontainers.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.kafka</groupId>
            <artifactId>spring-kafka-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.11.0</version>
                <configuration>
                    <source>17</source>
                    <target>17</target>
                    <annotationProcessorPaths>
                        <path>
                            <groupId>org.mapstruct</groupId>
                            <artifactId>mapstruct-processor</artifactId>
                            <version>${mapstruct.version}</version>
                        </path>
                    </annotationProcessorPaths>
                </configuration>
            </plugin>

            <!-- Surefire Plugin for Unit Tests -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>3.2.2</version>
                <configuration>
                    <includes>
                        <include>**/*Test.java</include>
                        <include>**/*Tests.java</include>
                    </includes>
                    <excludes>
                        <exclude>**/*IntegrationTest.java</exclude>
                    </excludes>
                </configuration>
            </plugin>

            <!-- Failsafe Plugin for Integration Tests -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-failsafe-plugin</artifactId>
                <version>3.2.2</version>
                <configuration>
                    <includes>
                        <include>**/*IntegrationTest.java</include>
                        <include>**/*IT.java</include>
                    </includes>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>integration-test</goal>
                            <goal>verify</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>

            <!-- JaCoCo Plugin for Code Coverage -->
            <plugin>
                <groupId>org.jacoco</groupId>
                <artifactId>jacoco-maven-plugin</artifactId>
                <version>0.8.11</version>
                <executions>
                    <execution>
                        <goals>
                            <goal>prepare-agent</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>report</id>
                        <phase>test</phase>
                        <goals>
                            <goal>report</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

    <profiles>
        <profile>
            <id>integration</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <skip>true</skip>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
</project>
```

---

## 🏗️ Clean Architecture Implementation

### Layer Responsibilities:

#### 1. Domain Layer (`/domain/`)
- **Purpose:** Core business logic, domain entities, business rules
- **Dependencies:** None (Pure Java)
- **Contains:**
  - **Entities:** Core business objects with identity and lifecycle
  - **Value Objects:** Immutable objects that describe characteristics
  - **Repository Interfaces:** Contracts for data persistence
  - **Domain Services:** Complex business logic that doesn't fit in entities

#### 2. Application Layer (`/application/`)
- **Purpose:** Application-specific business logic, use cases coordination
- **Dependencies:** Domain layer only
- **Contains:**
  - **Use Cases:** Application-specific business scenarios
  - **DTOs:** Data transfer between layers
  - **Validators:** Input validation logic

#### 3. Infrastructure Layer (`/infrastructure/`)
- **Purpose:** External concerns, frameworks, databases, message queues
- **Dependencies:** Domain and Application layers
- **Contains:**
  - **Persistence:** Database implementations
  - **External Services:** Third-party integrations
  - **Messaging:** Event publishing/consuming
  - **Configuration:** Framework-specific configuration

#### 4. Interface Layer (`/interfaces/`)
- **Purpose:** External interface adapters (REST, messaging)
- **Dependencies:** Application layer
- **Contains:**
  - **Web Controllers:** REST API endpoints
  - **Message Handlers:** Event listeners
  - **DTOs:** Request/Response objects
  - **Configuration:** Web-specific configuration

---

## 📋 Standard Configuration Files

### Application Configuration (application.yml)
```yaml
server:
  port: 8080
  servlet:
    context-path: /api/v1

spring:
  application:
    name: {service-name}-service
  
  profiles:
    active: dev
  
  datasource:
    url: jdbc:postgresql://localhost:5432/loyalty_{service-name}
    username: ${DB_USERNAME:loyalty_user}
    password: ${DB_PASSWORD:loyalty_pass}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
  
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    timeout: 2000ms
    jedis:
      pool:
        max-active: 8
        max-wait: -1ms
        max-idle: 8
        min-idle: 0
  
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
    consumer:
      group-id: {service-name}-service
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: com.example.loyalty.*

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when_authorized
  metrics:
    export:
      prometheus:
        enabled: true

logging:
  level:
    com.example.loyalty: INFO
    org.springframework.security: DEBUG
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{ISO8601} [%thread] %-5level %logger{36} - %msg%n"

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui
```

---

## 🔧 Standard Code Examples

### Domain Entity Example
```java
package com.example.loyalty.{service-name}.domain.entities;

import com.example.loyalty.{service-name}.domain.valueobjects.*;
import java.time.LocalDateTime;
import java.util.UUID;

public class {EntityName} {
    private UUID id;
    private String name;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    
    // Constructor
    public {EntityName}(String name) {
        this.id = UUID.randomUUID();
        this.name = name;
        this.createdAt = LocalDateTime.now();
        this.updatedAt = LocalDateTime.now();
    }
    
    // Business methods
    public void update(String newName) {
        this.name = newName;
        this.updatedAt = LocalDateTime.now();
    }
    
    // Getters (no setters for immutability)
    public UUID getId() { return id; }
    public String getName() { return name; }
    public LocalDateTime getCreatedAt() { return createdAt; }
    public LocalDateTime getUpdatedAt() { return updatedAt; }
}
```

### Use Case Example
```java
package com.example.loyalty.{service-name}.application.usecases;

import com.example.loyalty.{service-name}.domain.entities.*;
import com.example.loyalty.{service-name}.domain.repositories.*;
import com.example.loyalty.{service-name}.application.dto.*;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
@Transactional
public class Create{EntityName}UseCase {
    
    private final {EntityName}Repository repository;
    
    public Create{EntityName}UseCase({EntityName}Repository repository) {
        this.repository = repository;
    }
    
    public {EntityName}DTO execute(Create{EntityName}Request request) {
        // Validation
        validateRequest(request);
        
        // Create entity
        {EntityName} entity = new {EntityName}(request.getName());
        
        // Save
        {EntityName} saved = repository.save(entity);
        
        // Return DTO
        return {EntityName}DTO.from(saved);
    }
    
    private void validateRequest(Create{EntityName}Request request) {
        if (request.getName() == null || request.getName().trim().isEmpty()) {
            throw new IllegalArgumentException("Name cannot be empty");
        }
    }
}
```

### REST Controller Example
```java
package com.example.loyalty.{service-name}.interfaces.web.controllers;

import com.example.loyalty.{service-name}.application.usecases.*;
import com.example.loyalty.{service-name}.interfaces.web.dto.*;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;

@RestController
@RequestMapping("/api/v1/{service-name}")
@Tag(name = "{Service Name}", description = "{Service Name} management API")
public class {EntityName}Controller {
    
    private final Create{EntityName}UseCase create{EntityName}UseCase;
    
    public {EntityName}Controller(Create{EntityName}UseCase create{EntityName}UseCase) {
        this.create{EntityName}UseCase = create{EntityName}UseCase;
    }
    
    @PostMapping
    @Operation(summary = "Create new {entity name}")
    public ResponseEntity<ApiResponse<{EntityName}Response>> create(
            @RequestBody @Valid Create{EntityName}Request request) {
        
        {EntityName}DTO result = create{EntityName}UseCase.execute(request);
        
        return ResponseEntity.status(HttpStatus.CREATED)
            .body(ApiResponse.success(
                {EntityName}Response.from(result),
                "{EntityName} created successfully"
            ));
    }
}
```

---

## 🧪 Standard Testing Structure

### Unit Test Example
```java
package com.example.loyalty.{service-name}.unit.application.usecases;

import com.example.loyalty.{service-name}.application.usecases.*;
import com.example.loyalty.{service-name}.domain.repositories.*;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.BeforeEach;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;
import static org.mockito.ArgumentMatchers.*;
import static org.mockito.Mockito.*;
import static org.junit.jupiter.api.Assertions.*;

class Create{EntityName}UseCaseTest {
    
    @Mock
    private {EntityName}Repository repository;
    
    private Create{EntityName}UseCase useCase;
    
    @BeforeEach
    void setUp() {
        MockitoAnnotations.openMocks(this);
        useCase = new Create{EntityName}UseCase(repository);
    }
    
    @Test
    void shouldCreateEntitySuccessfully() {
        // Given
        Create{EntityName}Request request = new Create{EntityName}Request("Test Name");
        {EntityName} expectedEntity = new {EntityName}("Test Name");
        when(repository.save(any({EntityName}.class))).thenReturn(expectedEntity);
        
        // When
        {EntityName}DTO result = useCase.execute(request);
        
        // Then
        assertNotNull(result);
        assertEquals("Test Name", result.getName());
        verify(repository).save(any({EntityName}.class));
    }
}
```

---

## 📚 Documentation Standards

### README.md Template
```markdown
# {Service Name} Service

{Brief service description}

## Architecture

This service follows Clean Architecture principles with clear separation of concerns:
- Domain Layer: Core business logic
- Application Layer: Use cases and application services
- Infrastructure Layer: External integrations
- Interface Layer: REST controllers and message handlers

## Getting Started

### Prerequisites
- Java 17
- Maven 3.8+
- PostgreSQL 14+
- Redis 6+
- Apache Kafka 3.0+

### Local Development
1. Clone the repository
2. Run `./scripts/setup.sh`
3. Start dependencies: `docker-compose up -d`
4. Run the service: `./mvnw spring-boot:run`

### API Documentation
- Swagger UI: http://localhost:8080/swagger-ui
- OpenAPI Spec: http://localhost:8080/api-docs

## Testing
- Unit tests: `./mvnw test`
- Integration tests: `./mvnw test -P integration`
- All tests: `./mvnw verify`

## Deployment
See [deployment documentation](docs/deployment/README.md)
```

---

## ✅ Checklist for New Service Creation

### Setup Phase
- [ ] Replace `{service-name}` with actual service name in all files
- [ ] Replace `{Service Name}` with proper capitalized service name
- [ ] Replace `{EntityName}` with main domain entity name
- [ ] Update service description and purpose
- [ ] Configure database schema name

### Implementation Phase
- [ ] Implement domain entities and value objects
- [ ] Create repository interfaces in domain layer
- [ ] Implement use cases in application layer
- [ ] Create infrastructure layer implementations
- [ ] Build REST controllers in interface layer
- [ ] Add proper validation and error handling

### Quality Assurance
- [ ] Write unit tests for all use cases
- [ ] Create integration tests for repositories
- [ ] Add controller tests for REST endpoints
- [ ] Ensure >80% test coverage
- [ ] Configure code quality checks (SonarQube)

### Documentation
- [ ] Update README.md with service specifics
- [ ] Create OpenAPI specification
- [ ] Document deployment procedures
- [ ] Add architecture diagrams

### DevOps
- [ ] Configure Dockerfile and docker-compose
- [ ] Set up Kubernetes manifests
- [ ] Configure CI/CD pipeline
- [ ] Set up monitoring and logging

---

**Status:** Template Ready for Use  
**Usage:** Copy template and replace placeholders with service-specific values  
**Maintenance:** Update template when new standards or dependencies are adopted  